<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="style.css" type="text/css">
  <title>Document</title>
</head>
<body>
  <script src="https://d3js.org/d3.v5.js"></script>
  <script src="visualization.js"></script>
  <script>
    const data = fetch('http://localhost:3001')
      .then(res => res.json())
      .then(json => drawData(json))
      .catch(err => console.log(err))

    function drawData(data) {
      console.log(data)
      const maxBooks = data.map(year => {
        return year.booksByLanguage
          .map(language => language.books.length)
          .reduce((total, length) => total + length, 0)
      })
      console.log('maxBooks: ', maxBooks)
      const height = 400
      const width = 400
      const barWidth = 30
      const offset = 5

      const yScale = d3.scaleLinear()
        .domain([0, d3.max(maxBooks)])
        .range([0, height])
      const xScale = d3.scaleBand()
        .domain(maxBooks)
        .paddingInner(.3)
        .paddingOuter(.3)
        .range([0, width])

      const svg = d3.select('body')
        .append('svg')
        .style('background', 'lightblue')
        .attr('width', width)
        .attr('height', height)

      svg.selectAll('svg')
        .data(data).enter().append('svg')
          .attr('x', (d, index) => {
            console.log(index, d)
            return xScale(index)})
          .selectAll('rect')
            .data(d => d.booksByLanguage).enter().append('rect')
            .attr('fill', 'blue')
            .attr('width', xScale.bandwidth())
            .attr('height', d => yScale(d.books.length))
            .attr('x', 0)
            .attr('y', (d, index) => {

              return height - yScale(d.books.length)
            })
    }



  </script>
</body>
</html>
